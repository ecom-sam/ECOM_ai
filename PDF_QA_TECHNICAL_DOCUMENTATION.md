# PDF Q/A å¢å¼·ç³»çµ±æŠ€è¡“æ–‡æª”

## ğŸŒŸ ç³»çµ±ç™½è©±ä»‹ç´¹

æƒ³åƒä¸€ä¸‹ï¼Œç•¶ä½¿ç”¨è€…ä¸Šå‚³ä¸€ä»½ PDF æ–‡ä»¶åˆ°æˆ‘å€‘çš„æ™ºèƒ½å®¢æœç³»çµ±æ™‚ï¼Œæœƒç™¼ç”Ÿä»€éº¼ç¥å¥‡çš„äº‹æƒ…ï¼š

**ç¬¬ä¸€æ­¥ï¼šæ™ºèƒ½è®€å–**  
ç³»çµ±å°±åƒä¸€å€‹éå¸¸è°æ˜çš„åŠ©ç†ï¼Œä¸åªæœƒè®€æ–‡å­—ï¼Œé‚„æœƒã€Œçœ‹ã€åœ–ç‰‡ã€‚å®ƒæœƒé€é ç¿»é–± PDFï¼ŒæŠŠæ¯ä¸€é çš„æ–‡å­—å…§å®¹æå–å‡ºä¾†ï¼ŒåŒæ™‚ç™¼ç¾é é¢ä¸­çš„åœ–ç‰‡ï¼ˆåƒæ˜¯æµç¨‹åœ–ã€è¡¨æ ¼ã€åœ–è¡¨ç­‰ï¼‰ï¼Œç„¶å¾Œè«‹ OpenAI çš„ Vision AI ä¾†åˆ†æé€™äº›åœ–ç‰‡ï¼Œå‘Šè¨´æˆ‘å€‘ã€Œé€™å¼µåœ–åœ¨èªªä»€éº¼ã€ã€‚

**ç¬¬äºŒæ­¥ï¼šå…§å®¹æ•´åˆ**  
ç³»çµ±æœƒæŠŠæ–‡å­—å’Œåœ–ç‰‡çš„æè¿°åˆä½µåœ¨ä¸€èµ·ï¼Œå°±åƒäººé¡é–±è®€æ–‡ä»¶æ™‚æœƒåŒæ™‚ç†è§£æ–‡å­—å’Œåœ–è¡¨ä¸€æ¨£ï¼Œå½¢æˆå®Œæ•´çš„æ–‡æª”ç†è§£ã€‚

**ç¬¬ä¸‰æ­¥ï¼šé›™è»Œä¸¦è¡Œè™•ç†**  
æ¥ä¸‹ä¾†ç³»çµ±æœƒåŒæ™‚åšå…©ä»¶äº‹ï¼š
- **å·¦æ‰‹**ï¼šæŠŠæ–‡æª”å…§å®¹è½‰æ›æˆå‘é‡ï¼ˆæ•¸å­¸è¡¨ç¤ºï¼‰ï¼Œå„²å­˜èµ·ä¾†ä¾›å¾ŒçºŒæœå°‹ä½¿ç”¨
- **å³æ‰‹**ï¼šè«‹ OpenAI æ ¹æ“šæ•´ä»½æ–‡æª”å…§å®¹ï¼Œè‡ªå‹•ç”Ÿæˆ 10 å€‹å¯¦ç”¨çš„å•ç­”å°

**ç¬¬å››æ­¥ï¼šæ™ºèƒ½å•ç­”å°±ç·’**  
å®Œæˆå¾Œï¼Œä½¿ç”¨è€…å°±å¯ä»¥ï¼š
- ç›´æ¥å•é—œæ–¼é€™ä»½æ–‡æª”çš„ä»»ä½•å•é¡Œï¼ˆRAG æª¢ç´¢æœƒæ‰¾åˆ°ç›¸é—œå…§å®¹å›ç­”ï¼‰
- ç€è¦½ç³»çµ±è‡ªå‹•ç”Ÿæˆçš„ 10 å€‹å¸¸è¦‹å•ç­”
- äº«å—åŒ…å«åœ–ç‰‡å…§å®¹åˆ†æçš„å®Œæ•´å›ç­”

æ•´å€‹éç¨‹å°±åƒæ˜¯ç‚ºæ¯ä»½æ–‡æª”é…ç½®äº†ä¸€å€‹å°ˆå±¬çš„ AI åŠ©ç†ï¼Œæ—¢æ‡‚æ–‡å­—ä¹Ÿçœ‹å¾—æ‡‚åœ–ï¼Œé‚„æœƒä¸»å‹•æº–å‚™å¸¸è¦‹å•é¡Œçš„ç­”æ¡ˆã€‚

## ğŸ“‹ ç³»çµ±æ¦‚è¦½

é€™æ¬¡ä¿®æ”¹å¯¦ç¾äº†ä¸€å€‹å®Œæ•´çš„ PDF æ–‡æª”æ™ºèƒ½å•ç­”å¢å¼·ç³»çµ±ï¼Œä¸»è¦åŠŸèƒ½åŒ…æ‹¬ï¼š
- PDF æ–‡å­—å’Œåœ–ç‰‡å…§å®¹çš„å®Œæ•´æå–èˆ‡åˆ†æ
- åŸºæ–¼ OpenAI Vision API çš„åœ–ç‰‡å…§å®¹è­˜åˆ¥
- è‡ªå‹•ç”Ÿæˆç›¸é—œå•ç­”å°
- å‘é‡å„²å­˜èˆ‡ RAG æª¢ç´¢å¢å¼·
- ä¸¦è¡Œè™•ç†æå‡æ•ˆèƒ½

---

## ğŸ—ï¸ æ¶æ§‹è¨­è¨ˆ

### æ•´é«”è™•ç†æµç¨‹
```mermaid
flowchart TB
    A[User ä¸Šå‚³ PDF] --> B[DatasetManager.uploadFile]
    B --> C[ç™¼å¸ƒ AiFileUploadEvent]
    C --> D[AiFileEventListener.onAiFileUploadEvent]
    
    D --> E[EtlService.processFileWithQA]
    E --> F[CombinedPdfDocumentReader]
    F --> G[æ–‡å­—æå–]
    F --> H[åœ–ç‰‡æå–èˆ‡åˆ†æ]
    
    G --> I[åˆä½µæ–‡å­—èˆ‡åœ–ç‰‡æè¿°]
    H --> I
    I --> J[DocumentTransformer è™•ç†]
    
    J --> K[ä¸¦è¡Œè™•ç†]
    K --> L[VectorStore å‘é‡å„²å­˜]
    K --> M[QAGenerationService å•ç­”ç”Ÿæˆ]
    
    L --> N[ECOM.AI.document-vector]
    M --> O[ECOM.AI.qa]
    
    style F fill:#ff5722,color:#fff
    style H fill:#ff5722,color:#fff
    style K fill:#e1f5fe
    style M fill:#fff3e0
```

### æ ¸å¿ƒæ¨¡çµ„æ¶æ§‹
```
ğŸ“¦ ecom-assistant-ai (AI è™•ç†æ¨¡çµ„)
â”œâ”€â”€ ğŸ“„ CombinedPdfDocumentReader.java    # PDF æ–‡å­—+åœ–ç‰‡è™•ç†
â”œâ”€â”€ ğŸ“„ QAGenerationService.java          # OpenAI å•ç­”ç”Ÿæˆ
â”œâ”€â”€ ğŸ“„ EtlService.java                   # ETL è™•ç†ç®¡é“
â””â”€â”€ ğŸ“„ FileProcessingRuleConfig.java     # è™•ç†è¦å‰‡é…ç½®

ğŸ“¦ ecom-assistant-db (è³‡æ–™æ¨¡çµ„)
â”œâ”€â”€ ğŸ“„ QAPair.java                       # å•ç­”å°å¯¦é«”
â”œâ”€â”€ ğŸ“„ QAPairRepository.java             # å•ç­”è³‡æ–™å­˜å–
â””â”€â”€ ğŸ“„ QAPairService.java                # å•ç­”æ¥­å‹™é‚è¼¯

ğŸ“¦ ecom-assistant-core (æ ¸å¿ƒæ¨¡çµ„)
â””â”€â”€ ğŸ“„ AiFileEventListener.java          # æª”æ¡ˆäº‹ä»¶ç›£è½å™¨
```

---

## ğŸ”§ é—œéµæŠ€è¡“å¯¦ç¾

### 1. PDF æ–‡æª”è™•ç† (CombinedPdfDocumentReader)

#### æ–‡å­—å…§å®¹æå–
```java
// ä½¿ç”¨ PDFBox é€²è¡Œæ–‡å­—æå–
PDDocument document = PDDocument.load(resource.getInputStream());
PDFTextStripper stripper = new PDFTextStripper();
stripper.setStartPage(pageNumber);
stripper.setEndPage(pageNumber);
String pageText = stripper.getText(document);
```

#### åœ–ç‰‡å…§å®¹åˆ†æ
```java
// 1. åœ–ç‰‡æå–èˆ‡è½‰æ›
PDPage page = document.getPage(pageNumber - 1);
PDResources resources = page.getResources();

for (COSName name : resources.getXObjectNames()) {
    PDXObject xObject = resources.getXObject(name);
    if (xObject instanceof PDImageXObject) {
        PDImageXObject image = (PDImageXObject) xObject;
        BufferedImage bufferedImage = image.getImage();
        
        // 2. è½‰æ›ç‚º Base64
        ByteArrayOutputStream baos = new ByteArrayOutputStream();
        ImageIO.write(bufferedImage, "PNG", baos);
        byte[] imageBytes = baos.toByteArray();
        String base64Image = Base64.getEncoder().encodeToString(imageBytes);
        
        // 3. ä½¿ç”¨ OpenAI Vision API åˆ†æ
        String imageDescription = analyzeImageWithVision(base64Image);
    }
}
```

#### Vision API åœ–ç‰‡åˆ†æ
```java
private String analyzeImageWithVision(String base64Image) {
    try {
        // å»ºç«‹ Vision API è«‹æ±‚
        UserMessage userMessage = new UserMessage(
            "è«‹è©³ç´°æè¿°é€™å¼µåœ–ç‰‡çš„å…§å®¹ï¼Œç‰¹åˆ¥é—œæ³¨æ–‡å­—ã€æµç¨‹ã€æ­¥é©Ÿç­‰é‡è¦è³‡è¨Šï¼š",
            List.of(new Media(MimeType.IMAGE_PNG, base64Image))
        );
        
        // ä½¿ç”¨ ChatModel é€²è¡Œåˆ†æ
        ChatClient chatClient = ChatClient.create(chatModel);
        ChatResponse response = chatClient.prompt()
            .user(userMessage)
            .call()
            .chatResponse();
            
        return response.getResult().getOutput().getContent();
    } catch (Exception e) {
        log.warn("åœ–ç‰‡åˆ†æå¤±æ•—: {}", e.getMessage());
        return "[åœ–ç‰‡å…§å®¹ç„¡æ³•è­˜åˆ¥]";
    }
}
```

### 2. OpenAI å•ç­”ç”Ÿæˆ (QAGenerationService)

#### å•ç­”ç”Ÿæˆé‚è¼¯
```java
public void generateAndSaveQAPairs(String datasetId, String documentId, 
                                   String documentName, String content) {
    try {
        // 1. å»ºç«‹ OpenAI è«‹æ±‚
        String prompt = String.format("""
            åŸºæ–¼ä»¥ä¸‹æ–‡æª”å…§å®¹ï¼Œè«‹ç”Ÿæˆ 10 å€‹ç›¸é—œçš„å•ç­”å°ã€‚
            æ¯å€‹å•ç­”å°æ‡‰è©²ï¼š
            1. å•é¡Œè¦å…·é«”ä¸”æœ‰å¯¦ç”¨åƒ¹å€¼
            2. ç­”æ¡ˆè¦æº–ç¢ºä¸”åŸºæ–¼æ–‡æª”å…§å®¹
            3. æ¶µè“‹æ–‡æª”çš„ä¸»è¦æ¦‚å¿µå’Œé‡é»
            
            æ–‡æª”å…§å®¹ï¼š
            %s
            
            è«‹ä»¥ JSON æ ¼å¼å›æ‡‰ï¼ŒåŒ…å« questions é™£åˆ—ï¼Œæ¯å€‹å…ƒç´ æœ‰ question å’Œ answer æ¬„ä½ã€‚
            """, content);
        
        // 2. èª¿ç”¨ OpenAI API
        ChatClient chatClient = ChatClient.create(chatModel);
        String response = chatClient.prompt()
            .user(prompt)
            .call()
            .content();
        
        // 3. è§£æå›æ‡‰
        JsonNode jsonResponse = objectMapper.readTree(response);
        JsonNode questionsArray = jsonResponse.get("questions");
        
        // 4. å„²å­˜å•ç­”å°
        if (questionsArray != null && questionsArray.isArray()) {
            for (int i = 0; i < questionsArray.size(); i++) {
                JsonNode qa = questionsArray.get(i);
                QAPair qaPair = createQAPair(datasetId, documentId, 
                                           documentName, qa, i + 1);
                qaPairService.save(qaPair);
            }
        }
    } catch (Exception e) {
        log.error("å•ç­”ç”Ÿæˆå¤±æ•—: datasetId={}, documentId={}", 
                  datasetId, documentId, e);
    }
}
```

### 3. ETL è™•ç†ç®¡é“å„ªåŒ– (EtlService)

#### ä¸¦è¡Œè™•ç†å¯¦ç¾
```java
public void processFileWithQA(String datasetId, String datasetName, 
                              String documentId, String fileName, 
                              Resource resource) {
    try {
        // 1. æ–‡æª”è®€å–èˆ‡è™•ç†
        List<Document> documents = documentReader.get(resource);
        
        // 2. æ·»åŠ  metadata ç”¨æ–¼ RAG æª¢ç´¢
        documents.forEach(doc -> {
            doc.getMetadata().put("datasetId", datasetId);
            doc.getMetadata().put("datasetName", datasetName);
            doc.getMetadata().put("documentId", documentId);
        });
        
        // 3. æ–‡æª”è½‰æ›
        List<Document> transformedDocuments = documentTransformer.apply(documents);
        
        // 4. ä¸¦è¡Œè™•ç†ï¼šå‘é‡å„²å­˜ + å•ç­”ç”Ÿæˆ
        CompletableFuture<Void> vectorStoreTask = CompletableFuture.runAsync(() -> {
            vectorStore.add(transformedDocuments);
            log.info("å‘é‡å„²å­˜å®Œæˆ: {} å€‹æ–‡æª”", transformedDocuments.size());
        });
        
        CompletableFuture<Void> qaGenerationTask = CompletableFuture.runAsync(() -> {
            String combinedContent = documents.stream()
                .map(Document::getContent)
                .collect(Collectors.joining("\n\n"));
            qaGenerationService.generateAndSaveQAPairs(
                datasetId, documentId, fileName, combinedContent);
        });
        
        // 5. ç­‰å¾…æ‰€æœ‰ä»»å‹™å®Œæˆ
        CompletableFuture.allOf(vectorStoreTask, qaGenerationTask).join();
        
    } catch (Exception e) {
        log.error("æª”æ¡ˆè™•ç†å¤±æ•—: {}", fileName, e);
        throw new RuntimeException("æª”æ¡ˆè™•ç†å¤±æ•—", e);
    }
}
```

---

## ğŸ“Š è³‡æ–™çµæ§‹è¨­è¨ˆ

### QAPair å¯¦é«”è¨­è¨ˆ
```java
@Document
@Data
@NoArgsConstructor
@AllArgsConstructor
@Builder
public class QAPair {
    @Id
    private String id;                    // qa_<dataset>_<doc>_<timestamp>
    
    @Field("datasetId")
    private String datasetId;             // è³‡æ–™é›†ID
    
    @Field("documentId") 
    private String documentId;            // æ–‡æª”ID
    
    @Field("documentName")
    private String documentName;          // æ–‡æª”åç¨±
    
    @Field("question")
    private String question;              // å•é¡Œå…§å®¹
    
    @Field("answer")
    private String answer;                // ç­”æ¡ˆå…§å®¹
    
    @Field("questionIndex")
    private Integer questionIndex;        // å•é¡Œåºè™Ÿ (1-10)
    
    @Field("createdAt")
    private Instant createdAt;            // å»ºç«‹æ™‚é–“
}
```

### Couchbase Collection çµæ§‹
```sql
-- æ–°å¢çš„ QA Collection
CREATE COLLECTION ECOM.AI.qa IF NOT EXISTS;

-- å‘é‡æ–‡æª” metadata çµæ§‹
{
  "id": "doc_vector_123456",
  "content": "æ–‡æª”å…§å®¹...",
  "metadata": {
    "datasetId": "2c439a6e-97ff-4300-8bba-da5228c3130e",
    "datasetName": "TEST", 
    "documentId": "doc_456",
    "page": 1,
    "source": "è˜‘è‡å…¬å¸è¨‚å–®SOP.pdf"
  },
  "embedding": [0.1, 0.2, ...]
}

-- QA è³‡æ–™çµæ§‹
{
  "id": "qa_2c439a6e_doc456_1722075600000",
  "datasetId": "2c439a6e-97ff-4300-8bba-da5228c3130e",
  "documentId": "doc_456",
  "documentName": "è˜‘è‡å…¬å¸è¨‚å–®SOP.pdf",
  "question": "è˜‘è‡å…¬å¸çš„è¨‚å–®è™•ç†æµç¨‹åŒ…å«å“ªäº›æ­¥é©Ÿï¼Ÿ",
  "answer": "æ ¹æ“šSOPæ–‡æª”ï¼Œè¨‚å–®è™•ç†æµç¨‹åŒ…å«ï¼š1. è¨‚å–®æ¥æ”¶...",
  "questionIndex": 1,
  "createdAt": "2024-07-27T10:30:00Z"
}
```

---

## ğŸš€ é—œéµä¿®æ”¹é»

### 1. åºåˆ—åŒ–å•é¡Œä¿®å¾©
**å•é¡Œ**: `Media` å°è±¡åœ¨ç•°æ­¥è™•ç†ä¸­åºåˆ—åŒ–å¤±æ•—
**è§£æ±º**: åœ¨ Vision API èª¿ç”¨æ™‚å‰µå»ºç¨ç«‹çš„ `ChatClient`

```java
// ä¿®æ”¹å‰ (éŒ¯èª¤)
@Autowired
private ChatClient chatClient;  // æœƒå°è‡´åºåˆ—åŒ–éŒ¯èª¤

// ä¿®æ”¹å¾Œ (æ­£ç¢º)
ChatClient chatClient = ChatClient.create(chatModel);  // æœ¬åœ°å‰µå»º
```

### 2. RAG æª¢ç´¢ Metadata æ·»åŠ 
**å•é¡Œ**: å‘é‡æ–‡æª”ç¼ºå°‘ `datasetId` metadataï¼Œç„¡æ³•é€²è¡Œè³‡æ–™é›†éæ¿¾
**è§£æ±º**: åœ¨æ–‡æª”è™•ç†å‰æ·»åŠ å¿…è¦çš„ metadata

```java
// EtlService.java ç¬¬ 61-66 è¡Œ
documents.forEach(doc -> {
    doc.getMetadata().put("datasetId", datasetId);
    doc.getMetadata().put("datasetName", datasetName); 
    doc.getMetadata().put("documentId", documentId);
});
```

### 3. ç•°æ­¥è™•ç†ä¸Šä¸‹æ–‡å„ªåŒ–
**å•é¡Œ**: Spring Security ä¸Šä¸‹æ–‡åœ¨ç•°æ­¥ç’°å¢ƒä¸­ä¸Ÿå¤±
**è§£æ±º**: QAPair å¯¦é«”ä¸ç¹¼æ‰¿ `AuditableDocument`ï¼Œä½¿ç”¨æ‰‹å‹•æ™‚é–“æˆ³

```java
// QAPair.java - ä¸ä½¿ç”¨ Spring Data Auditing
@Builder.Default
private Instant createdAt = Instant.now();  // æ‰‹å‹•è¨­ç½®æ™‚é–“æˆ³
```

---

## ğŸ” è™•ç†æµç¨‹è©³è§£

### æª”æ¡ˆä¸Šå‚³åˆ°å•ç­”ç”Ÿæˆå®Œæ•´æµç¨‹

1. **æª”æ¡ˆä¸Šå‚³**
   ```java
   // DatasetManager.uploadFile()
   File savedFile = fileUploadService.saveFile(file, uploadDir);
   ```

2. **äº‹ä»¶ç™¼å¸ƒ**
   ```java
   // ç™¼å¸ƒæª”æ¡ˆä¸Šå‚³äº‹ä»¶
   AiFileUploadEvent event = new AiFileUploadEvent(datasetId, documentId, fileName, savedFile);
   applicationEventPublisher.publishEvent(event);
   ```

3. **ç•°æ­¥äº‹ä»¶è™•ç†**
   ```java
   // AiFileEventListener.onAiFileUploadEvent()
   @Async
   @EventListener
   public void onAiFileUploadEvent(AiFileUploadEvent event) {
       etlService.processFileWithQA(event.getDatasetId(), ...);
   }
   ```

4. **PDF å…§å®¹æå–**
   ```java
   // CombinedPdfDocumentReader.get()
   - é€é è™•ç† PDF
   - æå–æ–‡å­—å…§å®¹
   - è­˜åˆ¥ä¸¦åˆ†æåœ–ç‰‡ (Vision API)
   - åˆä½µæ–‡å­—èˆ‡åœ–ç‰‡æè¿°
   - ä¿æŒåŸå§‹é é¢é †åº
   ```

5. **ä¸¦è¡Œè™•ç†**
   ```java
   // EtlService.processFileWithQA()
   CompletableFuture<Void> vectorTask = CompletableFuture.runAsync(() -> {
       vectorStore.add(documents);  // å‘é‡å„²å­˜
   });
   
   CompletableFuture<Void> qaTask = CompletableFuture.runAsync(() -> {
       qaGenerationService.generateAndSaveQAPairs(...);  // å•ç­”ç”Ÿæˆ
   });
   ```

6. **å•ç­”ç”Ÿæˆ**
   ```java
   // QAGenerationService.generateAndSaveQAPairs()
   - åˆä½µæ‰€æœ‰æ–‡æª”å…§å®¹
   - èª¿ç”¨ OpenAI API ç”Ÿæˆ 10 å€‹å•ç­”å°
   - è§£æ JSON å›æ‡‰
   - å„²å­˜åˆ° ECOM.AI.qa collection
   ```

---

## ğŸ¯ æ•ˆèƒ½èˆ‡å„ªåŒ–

### ä¸¦è¡Œè™•ç†å„ªå‹¢
- **å‘é‡å„²å­˜** å’Œ **å•ç­”ç”Ÿæˆ** åŒæ™‚é€²è¡Œ
- ç¸½è™•ç†æ™‚é–“ â‰ˆ max(å‘é‡åŒ–æ™‚é–“, å•ç­”ç”Ÿæˆæ™‚é–“)
- ç›¸æ¯”ä¸²è¡Œè™•ç†ï¼Œæ•ˆèƒ½æå‡ç´„ 40-60%

### è¨˜æ†¶é«”å„ªåŒ–
- åœ–ç‰‡å³æ™‚è™•ç†å¾Œé‡‹æ”¾è¨˜æ†¶é«”
- Base64 ç·¨ç¢¼åƒ…åœ¨ Vision API èª¿ç”¨æ™‚ä½¿ç”¨
- æ–‡æª”åˆ†é è™•ç†é¿å…å¤§æª”æ¡ˆè¨˜æ†¶é«”æº¢å‡º

### API èª¿ç”¨å„ªåŒ–
- Vision API: åƒ…å°åŒ…å«åœ–ç‰‡çš„é é¢èª¿ç”¨
- OpenAI API: æ‰¹æ¬¡ç”Ÿæˆ 10 å€‹å•ç­”å°ï¼Œæ¸›å°‘ API èª¿ç”¨æ¬¡æ•¸
- éŒ¯èª¤é‡è©¦æ©Ÿåˆ¶å’Œè¶…æ™‚è¨­å®š

---

## ğŸ§ª æ¸¬è©¦é©—è­‰

### æ¸¬è©¦è³‡æ–™
- **æ¸¬è©¦æª”æ¡ˆ**: è˜‘è‡å…¬å¸è¨‚å–®SOP.pdf
- **è³‡æ–™é›†ID**: 2c439a6e-97ff-4300-8bba-da5228c3130e
- **æ–‡æª”ç‰¹é»**: åŒ…å«æ–‡å­—èªªæ˜å’Œæµç¨‹åœ–

### é©—è­‰çµæœ
âœ… **æ–‡å­—æå–**: æˆåŠŸæå–æ‰€æœ‰é é¢æ–‡å­—å…§å®¹  
âœ… **åœ–ç‰‡åˆ†æ**: Vision API æˆåŠŸåˆ†æ SOP æµç¨‹åœ–  
âœ… **å•ç­”ç”Ÿæˆ**: è‡ªå‹•ç”Ÿæˆ 10 å€‹ç›¸é—œå•ç­”å°  
âœ… **å‘é‡å„²å­˜**: æ–‡æª”æˆåŠŸå„²å­˜åˆ° document-vector collection  
âœ… **Metadata**: datasetIdã€documentId æ­£ç¢ºæ·»åŠ åˆ° metadata  

### RAG æª¢ç´¢æ¸¬è©¦
```bash
curl -X 'POST' \
  'http://localhost:8080/api/v1/ai/chat/topics/{topicId}/ask' \
  -H 'Authorization: Bearer [TOKEN]' \
  -d '{
    "message": "è˜‘è‡å…¬å¸è¨‚å–®è™•ç†æµç¨‹?",
    "withRag": true,
    "datasetIds": ["2c439a6e-97ff-4300-8bba-da5228c3130e"]
  }'
```

---

## ğŸ› ï¸ é…ç½®èªªæ˜

### æ ¸å¿ƒé…ç½®æª”æ¡ˆ
```yaml
# ecom-assistant-ai/src/main/resources/application.yaml
etl:
  file-processing:
    default:
      reader: combinedPdfDocumentReader  # ä½¿ç”¨å¢å¼·çš„ PDF è™•ç†å™¨
```

### ç’°å¢ƒè®Šæ•¸
```bash
# OpenAI API é…ç½®
SPRING_AI_OPENAI_API_KEY=sk-...
SPRING_AI_OPENAI_CHAT_OPTIONS_MODEL=gpt-4o

# Couchbase é…ç½®  
COUCHBASE_CONNECTION_STRING=couchbase://localhost
COUCHBASE_USERNAME=Administrator
COUCHBASE_PASSWORD=password
```

---

## ğŸš¨ æ³¨æ„äº‹é …èˆ‡é™åˆ¶

### æŠ€è¡“é™åˆ¶
1. **Vision API æˆæœ¬**: åœ–ç‰‡åˆ†ææœƒå¢åŠ  OpenAI API ä½¿ç”¨æˆæœ¬
2. **è™•ç†æ™‚é–“**: åŒ…å«å¤šå¼µåœ–ç‰‡çš„ PDF è™•ç†æ™‚é–“è¼ƒé•·
3. **åœ–ç‰‡è§£æåº¦**: ä½è§£æåº¦åœ–ç‰‡å¯èƒ½å½±éŸ¿ Vision API æ•ˆæœ

### æ¥­å‹™é™åˆ¶
1. **å•ç­”æ•¸é‡**: ç›®å‰å›ºå®šç”Ÿæˆ 10 å€‹å•ç­”å°
2. **èªè¨€æ”¯æ´**: ä¸»è¦é‡å°ç¹é«”ä¸­æ–‡å„ªåŒ–
3. **æª”æ¡ˆå¤§å°**: å»ºè­° PDF æª”æ¡ˆå°æ–¼ 50MB

### å®‰å…¨è€ƒé‡
1. **API Key å®‰å…¨**: OpenAI API Key å¿…é ˆå¦¥å–„ä¿è­·
2. **æª”æ¡ˆé©—è­‰**: ä¸Šå‚³æª”æ¡ˆéœ€è¦æ ¼å¼å’Œå¤§å°é©—è­‰
3. **æ¬Šé™æ§åˆ¶**: ç¢ºä¿ä½¿ç”¨è€…åªèƒ½å­˜å–æˆæ¬Šçš„è³‡æ–™é›†

---

## ğŸ“ˆ æœªä¾†æ“´å±•æ–¹å‘

### åŠŸèƒ½æ“´å±•
- [ ] æ”¯æ´æ›´å¤šæª”æ¡ˆæ ¼å¼ (Word, PowerPoint, Excel)
- [ ] è‡ªå®šç¾©å•ç­”ç”Ÿæˆæ•¸é‡
- [ ] å•ç­”å°å“è³ªè©•åˆ†æ©Ÿåˆ¶
- [ ] å¤šèªè¨€æ”¯æ´

### æŠ€è¡“å„ªåŒ–
- [ ] åœ–ç‰‡å…§å®¹å¿«å–æ©Ÿåˆ¶
- [ ] åˆ†æ•£å¼æª”æ¡ˆè™•ç†
- [ ] å³æ™‚è™•ç†é€²åº¦å›é¥‹
- [ ] A/B æ¸¬è©¦ä¸åŒ AI æ¨¡å‹æ•ˆæœ

### æ•´åˆæ“´å±•  
- [ ] èˆ‡ä¼æ¥­çŸ¥è­˜åº«ç³»çµ±æ•´åˆ
- [ ] æ”¯æ´å³æ™‚å”ä½œç·¨è¼¯å•ç­”
- [ ] å•ç­”å°åŒ¯å‡ºåŠŸèƒ½
- [ ] æ™ºèƒ½å•ç­”æ¨è–¦ç³»çµ±

---

## ğŸ“ æŠ€è¡“æ”¯æ´

### æ—¥èªŒç›£æ§
```bash
# æŸ¥çœ‹ AI è™•ç†æ—¥èªŒ
docker logs ecom-assistant | grep "QAGenerationService\|CombinedPdfDocumentReader"

# æŸ¥çœ‹å‘é‡å„²å­˜æ—¥èªŒ  
docker logs ecom-assistant | grep "VectorStore"
```

### å¸¸è¦‹å•é¡Œæ’è§£
1. **å•ç­”ç”Ÿæˆå¤±æ•—**: æª¢æŸ¥ OpenAI API Key å’Œç¶²è·¯é€£æ¥
2. **åœ–ç‰‡è­˜åˆ¥å¤±æ•—**: ç¢ºèªåœ–ç‰‡æ ¼å¼å’Œå¤§å°ç¬¦åˆ Vision API è¦æ±‚
3. **å‘é‡æª¢ç´¢ç„¡çµæœ**: ç¢ºèª datasetId metadata æ˜¯å¦æ­£ç¢ºæ·»åŠ 

---

*æ–‡æª”å»ºç«‹æ™‚é–“: 2024-07-27*  
*ç‰ˆæœ¬: v1.0*  
*ç‹€æ…‹: ç”Ÿç”¢å°±ç·’*