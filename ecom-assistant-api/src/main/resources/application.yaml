spring:


  application:
    name: ecom-assistant

  servlet:
    multipart:
      max-file-size: 50MB
      max-request-size: 50MB

  couchbase:
    connection-string: ${COUCHBASE_CONNECTION_STRINGS:localhost}
    username: ${COUCHBASE_USERNAME:Admin}
    password: ${COUCHBASE_PASSWORD:123456}

  data:
    couchbase:
      bucket-name: ${COUCHBASE_BUCKET_NAME:Embedding}
      scope-name: ${COUCHBASE_SCOPE_NAME:Testing}
      # auto-index: true  # å¦‚æœä½ éœ€è¦å•Ÿç”¨è‡ªå‹•å»ºç«‹ç´¢å¼•ï¼Œå–æ¶ˆè¨»è§£é€™è¡Œ

  cache:
    couchbase:
      scope-name: AI
      collection-name: cache

  ai:
    openai:
      api-key: ${OPENAI_API_KEY}
      chat:
#        base-url: https://api.groq.com/openai
#        api-key: ${GROK_API_KEY}
        options:
#          model: ${GROK_CHAT_MODEL:meta-llama/llama-4-maverick-17b-128e-instruct}
           model: gpt-4.1-mini
      embedding:
        options:
          model: text-embedding-3-small

    vectorstore:
      couchbase:
        initialize-schema: true
        bucket-name: ${spring.data.couchbase.bucket-name}
        scope-name: ${spring.data.couchbase.scope-name}
        collection-name: ${COUCHBASE_VECTOR_COLLECTION_NAME:document-vector}



file:
  upload-dir: ${FILE_UPLOAD_DIR:/tmp/uploads}

logging:
  level:
    org.springframework.ai.chat.client.advisor: DEBUG
    org.springframework.data.couchbase: DEBUG




etl:
  file-processing:
    default:
      reader: combinedPdfDocumentReader
      transformers: 
        - defaultTokenTextSplitter
      # æ–°å¢ï¼šä½ç½®æ’åºé…ç½®
      enable-position-sorting: true
      position-tolerance: 5.0
      # æ–°å¢ï¼šåœ–ç‰‡åˆ†æé…ç½®ï¼ˆé è¨­é—œé–‰ä»¥æå‡æ•ˆèƒ½ï¼‰
      enable-image-analysis: true
      image-analysis-timeout: 360




# ========================================================================
# RAG (æª¢ç´¢å¢å¼·ç”Ÿæˆ) åˆ†å±¤æª¢ç´¢é…ç½®
# ========================================================================
# ç”¨é€”ï¼šæ§åˆ¶ QA-vector å’Œ document-vector å…©å€‹å‘é‡è³‡æ–™åº«çš„æª¢ç´¢é †åº
# QA-vectorï¼šå„²å­˜å·²é©—è­‰çš„å•ç­”å°ï¼Œæä¾›ç²¾ç¢ºç­”æ¡ˆ
# document-vectorï¼šå„²å­˜åŸå§‹æ–‡æª”
# ========================================================================

rag:
  tiered-search:
    # ========================================================================
    # ç¸½é–‹é—œï¼šæ˜¯å¦å•Ÿç”¨åˆ†å±¤æª¢ç´¢
    # ========================================================================
    # trueï¼šå•Ÿç”¨å…©å±¤æª¢ç´¢ï¼ˆQA + Documentï¼‰
    # falseï¼šåƒ…ä½¿ç”¨å‚³çµ±çš„ document-vector æª¢ç´¢
    enabled: true
    
    # ========================================================================
    # ğŸ¯ æ ¸å¿ƒåŠŸèƒ½ï¼šæª¢ç´¢å„ªå…ˆé †åºæ§åˆ¶
    # ========================================================================
    # qa-firstï¼š      å„ªå…ˆæœå°‹ QA-vectorï¼Œå†è£œå…… document-vectorï¼ˆæ¨è–¦ï¼‰
    # document-firstï¼š å„ªå…ˆæœå°‹ document-vectorï¼Œå†è£œå…… QA-vector
    # qa-onlyï¼š       åƒ…æœå°‹ QA-vectorï¼ˆé©ç”¨æ–¼åªè¦ç²¾ç¢ºç­”æ¡ˆçš„å ´æ™¯ï¼‰
    # document-onlyï¼š  åƒ…æœå°‹ document-vectorï¼ˆé©ç”¨æ–¼éœ€è¦æ›´å¤šèƒŒæ™¯è³‡è¨Šçš„å ´æ™¯ï¼‰
    priority: qa-first
    
    # ========================================================================
    # QA å‘é‡æª¢ç´¢é…ç½®ï¼ˆå·²é©—è­‰çš„å•ç­”å°ï¼‰
    # ========================================================================
    qa-vector:
      # æ˜¯å¦å•Ÿç”¨ QA å‘é‡æª¢ç´¢
      enabled: true
      
      # QA æª¢ç´¢è¿”å›çš„æœ€å¤§çµæœæ•¸ï¼ˆç²¾ç¢ºç­”æ¡ˆè¨­å°ä¸€é»ï¼‰
      top-k: 3
      
      # QA æœå°‹ç­–ç•¥ï¼šæ±ºå®šä½¿ç”¨å“ªç¨®æŠ€è¡“æœå°‹ QA-vector
      # spring-ai-firstï¼š  å„ªå…ˆä½¿ç”¨ Spring AI VectorStoreï¼Œå¤±æ•—æ™‚åˆ‡æ›åˆ°ç›´æ¥ FTS
      # direct-fts-firstï¼š å„ªå…ˆä½¿ç”¨ç›´æ¥ FTS APIï¼Œå¤±æ•—æ™‚åˆ‡æ›åˆ° Spring AIï¼ˆæ¨è–¦ï¼‰
      # spring-ai-onlyï¼š   åƒ…ä½¿ç”¨ Spring AI VectorStore
      # direct-fts-onlyï¼š  åƒ…ä½¿ç”¨ç›´æ¥ FTS API
      search-strategy: direct-fts-first
      
      # Spring AI VectorStore é…ç½®ï¼ˆSpringæ¡†æ¶çš„å‘é‡æœå°‹ï¼‰
      spring-ai:
        # æ˜¯å¦å•Ÿç”¨ Spring AI æ–¹å¼
        enabled: true
        # ç›¸ä¼¼åº¦é–¾å€¼ï¼ˆ0.0-1.0ï¼Œè¶Šé«˜è¶Šåš´æ ¼ï¼‰
        similarity-threshold: 0.4
        
      # ç›´æ¥ FTS API é…ç½®ï¼ˆç›´æ¥å‘¼å« Couchbase FTSï¼‰
      direct-fts:
        # æ˜¯å¦å•Ÿç”¨ç›´æ¥ FTS æ–¹å¼
        enabled: true
        # Couchbase FTS ç´¢å¼•åç¨±
        index-name: ECOM-AI-qa-vector-index
        
    # ========================================================================
    # Document å‘é‡æª¢ç´¢é…ç½®ï¼ˆåŸå§‹æ–‡æª”åˆ‡ç‰‡ï¼‰
    # ========================================================================
    document-vector:
      # æ˜¯å¦å•Ÿç”¨ Document å‘é‡æª¢ç´¢
      enabled: true
      
      # Document æª¢ç´¢è¿”å›çš„æœ€å¤§çµæœæ•¸ï¼ˆé€šå¸¸è¨­å®šè¼ƒå¤§ï¼Œæä¾›æ›´å¤šå…¶ä»–æœ‰çš„æ²’çš„ï¼‰
      top-k: 6
      
      # ç›¸ä¼¼åº¦é–¾å€¼ï¼ˆ0.0-1.0ï¼Œè¶Šé«˜è¶Šåš´æ ¼ï¼‰
      similarity-threshold: 0.7
      
    # ========================================================================
    # æœå°‹åƒæ•¸é…ç½®
    # ========================================================================
    search:
      # ç¸½æª¢ç´¢çµæœçš„æœ€å¤§æ•¸é‡ï¼ˆQA + Document çš„ç¸½å’Œä¸Šé™ï¼‰
      max-total-results: 8
      
      # è‡ªå‹•é™ç´šé–‹é—œï¼šç•¶é¦–é¸æª¢ç´¢é¡å‹å¤±æ•—æ™‚ï¼Œæ˜¯å¦è‡ªå‹•åˆ‡æ›åˆ°å‚™ç”¨é¡å‹
      # trueï¼šå¤±æ•—æ™‚è‡ªå‹•é™ç´šï¼ˆå¦‚ qa-first å¤±æ•—æ™‚æ”¹ç”¨ document-onlyï¼‰
      # falseï¼šå¤±æ•—æ™‚ä¸é™ç´šï¼Œç›´æ¥è¿”å›ç©ºçµæœ
      enable-fallback: true

# ========================================================================
# é…ç½®ç¯„ä¾‹èªªæ˜ï¼š
# ========================================================================
# 1. ç²¾ç¢ºå•ç­”å„ªå…ˆï¼ˆæ¨è–¦ï¼‰ï¼š
#    priority: qa-first, qa-vector.top-k: 3, document-vector.top-k: 5
#    
# 2. èƒŒæ™¯è³‡è¨Šå„ªå…ˆï¼š
#    priority: document-first, document-vector.top-k: 6, qa-vector.top-k: 2
#    
# 3. ç´”å•ç­”æ¨¡å¼ï¼š
#    priority: qa-only, qa-vector.top-k: 5
#    
# 4. ç´”æ–‡æª”æ¨¡å¼ï¼š
#    priority: document-only, document-vector.top-k: 8
# ========================================================================
